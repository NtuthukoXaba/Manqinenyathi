{% extends "cooker_base.html" %}

{% block title %}Cooker Dashboard | Manqinenyathi Food Supply{% endblock %}

{% block page_title %}Cooker Dashboard{% endblock %}

{% block content %}
<!-- Alert -->
<div class="alert alert-info d-flex align-items-center" role="alert">
    <i class="fas fa-info-circle me-2"></i>
    <div>Welcome back! Today's date is <strong id="currentDate">{{ today }}</strong>. Remember to clock in when you start and clock out when you finish.</div>
</div>

<!-- Dashboard Stats -->
<div class="row">
    <div class="col-md-3">
        <div class="dashboard-card">
            <div class="card-icon">
                <i class="fas fa-school"></i>
            </div>
            <h3 id="assignedSchool">{{ assigned_school.school_name if assigned_school else "Not Assigned" }}</h3>
            <p>Assigned School</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card">
            <div class="card-icon">
                <i class="fas fa-utensils"></i>
            </div>
            <h3 id="learnersFed">{{ learners_fed_today }}</h3>
            <p>Learners Fed Today</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card">
            <div class="card-icon">
                <i class="fas fa-user-clock"></i>
            </div>
            <h3 id="workHours">{{ work_hours }} hrs</h3>
            <p>Today's Work Hours</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card">
            <div class="card-icon">
                <i class="fas fa-calendar-check"></i>
            </div>
            <h3 id="daysWorked">{{ days_worked }}</h3>
            <p>Days Worked This Month</p>
        </div>
    </div>
</div>

<!-- Main Content Row -->
<div class="row">
    <!-- Attendance Section -->
    <div class="col-md-6">
        <div class="attendance-card">
            <h3><i class="fas fa-user-clock me-2"></i>Attendance</h3>
            
            <div class="d-flex justify-content-between mb-3">
                <div>
                    <h5>Current Status</h5>
                    <span class="status-badge {% if today_attendance and today_attendance.time_in and not today_attendance.time_out %}status-clocked-in{% else %}status-clocked-out{% endif %}" id="statusBadge">
                        {% if today_attendance and today_attendance.time_in and not today_attendance.time_out %}Clocked In{% else %}Clocked Out{% endif %}
                    </span>
                </div>
                <div class="text-end">
                    <h5>Today's Date</h5>
                    <span id="todayDate">{{ today.strftime('%B %d, %Y') }}</span>
                </div>
            </div>
            
            <div class="time-display" id="currentTime">
                00:00:00
            </div>
            
            <div class="mb-4">
                {% if not today_attendance or not today_attendance.time_in %}
                <form method="POST" action="{{ url_for('clock_in') }}" class="d-inline w-100">
                    <button type="submit" class="attendance-btn btn-clock-in" id="clockInBtn">
                        <i class="fas fa-sign-in-alt me-2"></i>Clock In
                    </button>
                </form>
                {% endif %}
                
                {% if today_attendance and today_attendance.time_in and not today_attendance.time_out %}
                <form method="POST" action="{{ url_for('clock_out') }}" class="d-inline w-100">
                    <button type="submit" class="attendance-btn btn-clock-out" id="clockOutBtn">
                        <i class="fas fa-sign-out-alt me-2"></i>Clock Out
                    </button>
                </form>
                {% endif %}
            </div>
            
            <div class="today-times">
                <h5>Today's Times</h5>
                <div class="d-flex justify-content-between">
                    <span>Time In:</span>
                    <strong id="timeInDisplay">
                        {% if today_attendance and today_attendance.time_in %}
                            {{ today_attendance.time_in.strftime('%H:%M') }}
                        {% else %}
                            --:--
                        {% endif %}
                    </strong>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Time Out:</span>
                    <strong id="timeOutDisplay">
                        {% if today_attendance and today_attendance.time_out %}
                            {{ today_attendance.time_out.strftime('%H:%M') }}
                        {% else %}
                            --:--
                        {% endif %}
                    </strong>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Today's Summary Section -->
    <div class="col-md-6">
        <div class="summary-card">
            <h3><i class="fas fa-chart-pie me-2"></i>Today's Summary</h3>
            <div class="row mt-3">
                <div class="col-6">
                    <h5>Learners Served</h5>
                    <h3 id="summaryLearners">{{ learners_fed_today }}</h3>
                </div>
                <div class="col-6">
                    <h5>Meals Prepared</h5>
                    <h3 id="summaryMeals">{{ learners_fed_today }}</h3>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-6">
                    <h5>Work Hours</h5>
                    <h3 id="summaryHours">{{ work_hours }} hrs</h3>
                </div>
                <div class="col-6">
                    <h5>Efficiency</h5>
                    <h3 id="summaryEfficiency">
                        {% if learners_fed_today > 0 %}
                            {{ (learners_fed_today / (work_hours if work_hours > 0 else 1)) | round | int }}/hr
                        {% else %}
                            0/hr
                        {% endif %}
                    </h3>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="content-card mt-4">
            <h3><i class="fas fa-bolt me-2"></i>Quick Actions</h3>
            <div class="row mt-3">
                <div class="col-6">
                    <a href="{{ url_for('cooker_learners_records') }}" class="btn btn-primary w-100 mb-2">
                        <i class="fas fa-graduation-cap me-1"></i> Manage Learners
                    </a>
                </div>
                <div class="col-6">
                    <a href="{{ url_for('cooker_attendance') }}" class="btn btn-outline-primary w-100 mb-2">
                        <i class="fas fa-history me-1"></i> View Attendance
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Your existing CSS styles remain the same */
    .dashboard-card {
        background-color: var(--white);
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-bottom: 20px;
        transition: transform 0.3s;
        border-top: 4px solid var(--primary-purple);
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
    }
    
    .dashboard-card .card-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: rgba(106, 13, 173, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
    }
    
    .dashboard-card .card-icon i {
        font-size: 24px;
        color: var(--primary-purple);
    }
    
    .dashboard-card h3 {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 5px;
        color: var(--primary-purple);
    }
    
    .dashboard-card p {
        color: var(--dark-gray);
        margin: 0;
    }
    
    .attendance-card, .summary-card, .content-card {
        background-color: var(--white);
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        padding: 25px;
        margin-bottom: 20px;
    }
    
    .attendance-card h3, .summary-card h3, .content-card h3 {
        color: var(--primary-purple);
        margin-bottom: 20px;
        font-weight: 700;
    }
    
    .time-display {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-purple);
        text-align: center;
        margin: 15px 0;
    }
    
    .attendance-btn {
        padding: 12px 25px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 8px;
        border: none;
        transition: all 0.3s;
        width: 100%;
        margin-bottom: 10px;
    }
    
    .btn-clock-in {
        background-color: var(--primary-purple);
        color: white;
    }
    
    .btn-clock-in:hover {
        background-color: var(--dark-purple);
    }
    
    .btn-clock-out {
        background-color: #dc3545;
        color: white;
    }
    
    .btn-clock-out:hover {
        background-color: #c82333;
    }
    
    .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .status-clocked-in {
        background-color: rgba(40, 167, 69, 0.1);
        color: #28a745;
    }
    
    .status-clocked-out {
        background-color: rgba(220, 53, 69, 0.1);
        color: #dc3545;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Update current time
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString();
        document.getElementById('currentTime').textContent = timeString;
        
        // Update date in alert
        const dateString = now.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        document.getElementById('currentDate').textContent = dateString;
    }
    
    // Update time every second
    setInterval(updateTime, 1000);
    updateTime(); // Initial call
</script>
{% endblock %}