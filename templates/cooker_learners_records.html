{% extends "cooker_base.html" %}

{% block title %}Learner Records | Manqinenyathi Food Supply{% endblock %}

{% block page_title %}Learner Records Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <!-- Add Learner Form -->
        <div class="content-card mb-4">
            <h3 class="text-purple mb-4">
                <i class="fas fa-graduation-cap me-2"></i>Add New Learner
            </h3>
            
            <form method="POST" action="{{ url_for('add_learner') }}">
                <div class="row">
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="learner_name" class="form-label">Learner Name *</label>
                            <input type="text" class="form-control" id="learner_name" name="learner_name" 
                                   placeholder="Enter learner's full name" required>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="grade" class="form-label">Grade/Class *</label>
                            <select class="form-control" id="grade" name="grade" required>
                                <option value="">Select Grade</option>
                                <option value="Grade R">Grade R</option>
                                <option value="Grade 1">Grade 1</option>
                                <option value="Grade 2">Grade 2</option>
                                <option value="Grade 3">Grade 3</option>
                                <option value="Grade 4">Grade 4</option>
                                <option value="Grade 5">Grade 5</option>
                                <option value="Grade 6">Grade 6</option>
                                <option value="Grade 7">Grade 7</option>
                                <option value="Grade 8">Grade 8</option>
                                <option value="Grade 9">Grade 9</option>
                                <option value="Grade 10">Grade 10</option>
                                <option value="Grade 11">Grade 11</option>
                                <option value="Grade 12">Grade 12</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="meal_type" class="form-label">Meal Type *</label>
                            <select class="form-control" id="meal_type" name="meal_type" required>
                                <option value="Breakfast">Breakfast</option>
                                <option value="Lunch" selected>Lunch</option>
                                <option value="Both">Both</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="mb-3">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-save me-1"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Today's Learners -->
        <div class="content-card mb-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-purple mb-0">
                    <i class="fas fa-list me-2"></i>Today's Learners ({{ today.strftime('%Y-%m-%d') }})
                </h3>
                <span class="badge bg-purple">{{ todays_learners|length }} learners</span>
            </div>
            
            {% if todays_learners %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Learner Name</th>
                            <th>Grade</th>
                            <th>Meal Type</th>
                            <th>Time Recorded</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for learner in todays_learners %}
                        <tr>
                            <td>{{ learner.learner_name }}</td>
                            <td>{{ learner.grade }}</td>
                            <td>
                                <span class="badge {% if learner.meal_type == 'Breakfast' %}bg-warning{% elif learner.meal_type == 'Lunch' %}bg-success{% else %}bg-info{% endif %}">
                                    {{ learner.meal_type }}
                                </span>
                            </td>
                            <td>{{ learner.created_at.strftime('%H:%M') }}</td>
                            <td>
                                <form method="POST" action="{{ url_for('delete_learner', learner_id=learner.learner_id) }}" 
                                      class="d-inline" onsubmit="return confirm('Are you sure you want to delete this learner record?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <i class="fas fa-graduation-cap fa-3x text-muted mb-3"></i>
                <p class="text-muted">No learners recorded for today.</p>
            </div>
            {% endif %}
        </div>


            {% if all_learners %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Learner Name</th>
                            <th>Grade</th>
                            <th>Meal Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for learner in all_learners %}
                        <tr>
                            <td>{{ learner.date_served.strftime('%Y-%m-%d') }}</td>
                            <td>{{ learner.learner_name }}</td>
                            <td>{{ learner.grade }}</td>
                            <td>
                                <span class="badge {% if learner.meal_type == 'Breakfast' %}bg-warning{% elif learner.meal_type == 'Lunch' %}bg-success{% else %}bg-info{% endif %}">
                                    {{ learner.meal_type }}
                                </span>
                            </td>
                            <td>
                                <form method="POST" action="{{ url_for('delete_learner', learner_id=learner.learner_id) }}" 
                                      class="d-inline" onsubmit="return confirm('Are you sure you want to delete this learner record?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
           
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .bg-purple {
        background-color: var(--primary-purple) !important;
    }
    
    .btn-outline-danger:hover {
        background-color: #dc3545;
        border-color: #dc3545;
    }
    
    .table th {
        background-color: rgba(106, 13, 173, 0.1);
        color: var(--primary-purple);
        border-top: none;
        font-weight: 600;
    }
    
    .badge.bg-warning {
        background-color: #ffc107 !important;
        color: #000;
    }
    
    .badge.bg-success {
        background-color: #198754 !important;
    }
    
    .badge.bg-info {
        background-color: #0dcaf0 !important;
        color: #000;
    }
</style>
{% endblock %}